{% extends 'base/base.html' %}
{% load static %}

{% block header %}
{% if user.is_staff %}
{% include 'base/menuAdministrador.html' %}
{% elif user.groups.all.0.name == 'Cliente' %}
{% include 'base/menuCliente.html' %}
{% else%}
{% include 'base/menuNoLog.html' %}
{% endif %}
{% endblock %}

{% block content %}
<div class="container mt-3">
    <div class="card">
        <div class="card-header">
            <h3>Carro de compras</h3>
        </div>  
        <div class="card-body">
         <table class = 'table table-hover table-striped'>
            <thead>
                <tr>
                    <th>Producto</th>
                    <th style='text-align:center'>Cantidad</th>
                    <th style='text-align:center'>Precio total</th>
                </tr>
            </thead>
            <tbody>
            {% csrf_token %}
            {% if carro%}
            {% for producto in carro %}
                {%for p in desc_productos%}
                    {% if producto.cantidad > 0 %}
                    {% if forloop.counter == forloop.parentloop.counter %}
                    <tr>
                        <td>{{p.nombre}}</td>
                        <td style='text-align:center'> <a type="button" data-toggle="tooltip" data-placement="top" title="Eliminar una unidad"><i class="fas fa-minus" style='color:#ff6600' id="minus{{p.id_producto}}" ></i></a>&nbsp&nbsp&nbsp
                        {{producto.cantidad}}&nbsp&nbsp&nbsp
                        <a type="button" data-toggle="tooltip" data-placement="right" title="AÃ±adir una unidad"><i class="fas fa-plus" style='color:#ff6600' id="plus{{p.id_producto}}"></i></a></td>
                        <td style='text-align:center'>{% widthratio p.precio 1 producto.cantidad%}</td>   
                    </tr>   
                    {%endif%}
                    {% endif %}
                {% endfor %}
            {% endfor %}
            {% endif %}
            </tbody>
          </table>
        </div>
    </div>
</div> 


{% comment %} <script type="text/javascript" src= "{% static 'js/material.js' %}"> </script>
<script type="text/javascript" src="{% static 'js/jquery.min.js' %}"></script> {% endcomment %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/d3js/6.2.0/d3.min.js"></script>
{% comment %} <script src="{% static 'js/main.js' %}"></script> {% endcomment %}


    <script type="text/javascript">
    data = {{id_productos}}
    for (p in data){
        boton = "#plus" + data[p]
        boton2 = "#minus" + data[p]
        //console.log(boton)

        $(document).on('click',boton,function(e){
            e.preventDefault();
            $.ajax({
                type:'POST',
                url:'{%  url 'sumar' %}',
                data:{
                    id_producto: data[p],//5
                    csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
                },
            success: function(){
                alert('Por fin!')
            }
       
    })})
        $(document).on('click',boton2,function(e){
            e.preventDefault();
            $.ajax({
                type:'POST',
                url:'{%  url 'restar' %}',
                data:{
                    id_producto: data[p],//5
                    csrfmiddlewaretoken:$('input[name=csrfmiddlewaretoken]').val()
                },
            success: function(){
                alert('Por fin!')
            }
       
    })
    //var page = $(this).attr('href');
    // $(document).load(page)
    //console.log(data[p])
    })}
    
    </script>
{% endblock %}
